当客户端与服务器之间不再需要传输数据时，通过四次挥手断开连接，

第一次挥手，客户端向服务器发送一个将结束标志位FIN置1的数据包，进入FIN_WAIT_1状态，

第二次握手，服务器接收到客户端发送的数据包以后，向客户端发送将确认标志位ACK

置1的标志位，进入close_wait状态；客户端收到这个数据包以后进入FIN_WAIT_2状态，

这个阶段以后只有服务器可以向客户端发送数据，数据发送以后结束进入第三次握手；

第三次握手，服务端发送将ACK标志位置1的数据包，进入last_ack状态，

第四次挥手，客户端向服务器发送一个将确认标志位ACK置1的数据包，等待两个MSL后断开连接。



为什么客户端在发送ACK之后需要等两个MSL？

因为如果ACK包丢失的话，服务器会以为客户端没有收到FIN包，会再次向客户端发送FIN包，如果客户端直接关闭没有等待的话，会导致服务器重复发送，如果是等待的话，客户端再发一次ACK，更新计时时间，服务器收到以后就可以顺利关闭了。