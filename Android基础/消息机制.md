Android的消息机制就是handler运行机制和附带的MessageQueue和Looper的工作过程，通过handler可以将一个任务切换到handler所在的线程中去执行，handler主要使用在更新UI的场景，比如在子线程中执行了比较耗时的操作，打开文件或者进行网络请求之类的，然后需要更新UI显示，但是由于Android中不能通过子线程更新UI，所以需要将更新操作切换到主线程，这种场景就可以使用handler。

threadLocal是线程内部的一个数据存储类，通过它可以向特定的线程存储数据，只有在特定的线程才可以取出数据，通常使用在不同的线程有不同的数据副本的情况，比如不同的线程需要不同的looper，就可以通过threadLocal实现。

handler需要与消息队列messageQueue和消息泵looper配合实现，消息队列以队列的形式向外提供插入和取出的操作，消息队列是通过链表实现的，looper以无限循环的形式不断去查询消息队列中是否有消息，有就取出给handler处理，没有就一直等待。

其他线程通过调用handler的sendMessage方法，将消息传递给handler的消息对列，sendMessage会调用enqueueMessage方法，将消息加入消息对列，MessageQueue主要有两个方法，enqueueMessage和next，分别用于向队列中插入消息和取出消息，Looper的loop方法开启消息循环，loop方法中主要是一个无限循环，当消息队列不为空时调用消息队列的next取出消息，为空就一直等待，调用handler的dispatchMessage方法来处理任务，dispatchMessage会调用handler的handleMessage方法进行处理，这样任务就传递到了handler所在的线程。